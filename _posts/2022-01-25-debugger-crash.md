---
layout: post
title:  调试C++程序崩溃
date:   2022-01-25 17:07:26 +0800
tag:    notes
---

- core文件生效
    ```bash
    echo "* soft core unlimited" | sudo dd of=/etc/security/limits.d/core.conf
    #重启 下面这行无法永久修改 重启后总是被重写 以后解决
    sudo sysctl -w kernel.core_pattern=/tmp/core-%e.%p.%h.%t
    ```

- 编辑崩溃程序(a.cpp)
    ```cpp
    #include <iostream>
    
    void test01()
    {
        int *p = nullptr;
        *p = 23;
    }
    
    int main()
    {
        test01();
        return 0;
    }
    ```
- 编译奔溃程序(注意要加-g)
    ```bash
    > g++ -o bin -g a.cpp
    ```
- 执行崩溃程序生成core文件
    ```bash
    > ./bin
    > ls /tmp/ | grep core
    ```
    ```plain
    core-bin.4079.ubuntu.1643104689
    ```
- 通过core文件查看崩溃信息
    ```bash
    > gdb ./bin /tmp/core-bin.4079.ubuntu.1643104689
    ```
    ```plain
    GNU gdb (Ubuntu 9.2-0ubuntu1~20.04) 9.2
    Copyright (C) 2020 Free Software Foundation, Inc.
    License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
    This is free software: you are free to change and redistribute it.
    There is NO WARRANTY, to the extent permitted by law.
    Type "show copying" and "show warranty" for details.
    This GDB was configured as "x86_64-linux-gnu".
    Type "show configuration" for configuration details.
    For bug reporting instructions, please see:
    <http://www.gnu.org/software/gdb/bugs/>.
    Find the GDB manual and other documentation resources online at:
        <http://www.gnu.org/software/gdb/documentation/>.

    For help, type "help".
    Type "apropos word" to search for commands related to "word"...
    Reading symbols from ./bin...
    [New LWP 4079]
    Core was generated by `./bin'.
    Program terminated with signal SIGSEGV, Segmentation fault.
    #0  0x000055805d8ff17d in test01 () at a.cpp:6
    6	    *p = 23;
    ```